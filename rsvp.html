<main class="section">
  <h2>RSVP</h2>
  <p style="color:var(--muted);margin-bottom:12px;">Conferma la tua presenza. Il modulo è personalizzato per te.</p>

  <!-- ✅ Netlify Forms -->
  <form name="rsvp" method="POST" data-netlify="true" netlify-honeypot="bot-field"
        action="/success.html" class="card" id="rsvpForm">
    <input type="hidden" name="form-name" value="rsvp" />
    <input type="hidden" name="invite_flags" id="inviteFlags" value="wedding" />
    <input type="hidden" name="guest_code" id="guestCode" value="" />
    <input type="hidden" name="lang" id="langField" value="it" />
    <input type="hidden" name="page" value="/rsvp.html" />
    <p style="display:none"><label>Don’t fill this out: <input name="bot-field" /></label></p>

    <div class="grid-2">
      <p><label for="name">Nome e cognome<br>
        <input id="name" name="name" type="text" required
               style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;">
      </label></p>
      <p><label for="email">Email<br>
        <input id="email" name="email" type="email" required
               style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;">
      </label></p>
    </div>

    <p id="attendingLabel" style="margin-top:6px;font-weight:600;">Parteciperai al matrimonio di Charlotte &amp; Gianluca?</p>
    <div class="grid-2" style="margin-bottom:8px">
      <label for="yes" class="card" style="display:flex;align-items:center;gap:10px;">
        <input id="yes" type="radio" name="attending" value="yes" required> <span>Sì, con gioia</span>
      </label>
      <label for="no" class="card" style="display:flex;align-items:center;gap:10px;">
        <input id="no" type="radio" name="attending" value="no"> <span>Mi dispiace, non potrò</span>
      </label>
    </div>

    <!-- Queste righe compaiono SOLO se attending=yes -->
    <div id="attendingBlock" style="display:none">
      <div id="rowDinner" class="card" style="margin-top:12px;">
        <label for="dinner" style="display:flex;align-items:center;gap:10px;">
          <input id="dinner" type="checkbox" name="welcome_dinner" value="yes">
          <span>Parteciperai alla cena di benvenuto (venerdì sera)?</span>
        </label>
      </div>

      <div id="rowBrunch" class="card" style="margin-top:12px;">
        <label for="brunch" style="display:flex;align-items:center;gap:10px;">
          <input id="brunch" type="checkbox" name="sunday_brunch" value="yes">
          <span>Parteciperai al brunch della domenica?</span>
        </label>
      </div>

      <div class="grid-2" style="margin-top:12px;">
        <p><label for="guests"><span>Numero totale di persone (incluso te)</span><br>
          <input id="guests" name="guests" type="number" min="1" max="10" value="1"
                 style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;">
        </label></p>

        <p><label for="dietary"><span>Allergie o esigenze alimentari</span><br>
          <input id="dietary" name="dietary" type="text" placeholder="es. vegetariano, senza glutine"
                 style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;">
        </label></p>
      </div>

      <!-- Nomi ospiti generati in base al numero -->
      <div id="guestNamesWrap" class="card" style="display:none; margin-top:12px;">
        <strong>Nome degli ospiti</strong>
        <div id="guestNames" style="margin-top:8px; display:grid; gap:8px;"></div>
      </div>
    </div>

    <p style="margin-top:12px;">
      <label for="message"><span>Messaggio (opzionale)</span><br>
        <textarea id="message" name="message" rows="4"
                  style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;"></textarea>
      </label>
    </p>

    <!-- (Opzionale) reCAPTCHA di Netlify: scommenta la riga sotto e attivalo nella dashboard Forms -->
    <!-- <div data-netlify-recaptcha="true" style="margin:10px 0;"></div> -->

    <p><button type="submit" class="btn" id="submitBtn">Invia RSVP</button></p>
  </form>

  <p style="margin-top:10px;color:var(--muted);font-size:14px">
    Link di test: <a href="/rsvp.html?guest=demo&inv=all">versione “tutti gli eventi”</a>
  </p>
</main>

<script>
// Menu mobile
const btn=document.getElementById('hambBtn'), menu=document.getElementById('mobileMenu');
if(btn&&menu){btn.addEventListener('click',()=>{menu.style.display=(menu.style.display==='block')?'none':'block';});
document.addEventListener('click',e=>{if(!menu.contains(e.target)&&e.target!==btn) menu.style.display='none';});}

// Personalizzazione invito da URL (?guest=...&inv=wedding+dinner|wedding+brunch|all)
(function(){
  const p=new URLSearchParams(window.location.search);
  const inv=(p.get('inv')||'wedding').toLowerCase();
  const showDinner=inv==='all'||inv.includes('dinner');
  const showBrunch=inv==='all'||inv.includes('brunch');
  document.getElementById('inviteFlags').value=inv;
  const g=p.get('guest')||''; document.getElementById('guestCode').value=g;

  const dinner=document.getElementById('rowDinner');
  const brunch=document.getElementById('rowBrunch');
  if(dinner) dinner.style.display=showDinner?'block':'none';
  if(brunch) brunch.style.display=showBrunch?'block':'none';
})();

// Logica UI: mostra blocchi solo se "Partecipo"
(function(){
  const yes=document.getElementById('yes');
  const no=document.getElementById('no');
  const block=document.getElementById('attendingBlock');
  function toggle(){ block.style.display = yes.checked ? 'block' : 'none'; }
  [yes,no].forEach(r=>r&&r.addEventListener('change',toggle));
  toggle();
})();

// Genera i campi nome ospiti in base al numero
(function(){
  const guests=document.getElementById('guests');
  const wrap=document.getElementById('guestNamesWrap');
  const holder=document.getElementById('guestNames');
  function render(){
    const n=parseInt(guests.value||'1',10);
    holder.innerHTML='';
    // se n>1 aggiungiamo i campi per gli altri ospiti (oltre al mittente)
    if(n>1){
      wrap.style.display='block';
      for(let i=2;i<=n;i++){
        const label=document.createElement('label');
        label.innerHTML = 'Ospite ' + i + ' — Nome e cognome<br>' +
          '<input name="guest_'+i+'_name" type="text" style="width:100%;padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.15);background:white;">';
        holder.appendChild(label);
      }
    }else{
      wrap.style.display='none';
    }
  }
  if(guests){ guests.addEventListener('input',render); render(); }
})();
</script>
