<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team Cha ðŸ’œ vs Team Gianlu ðŸ§¢ â€“ This or That</title>
  <link href="https://fonts.googleapis.com/css2?family=Allura&family=Cormorant:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --lavender:#bca9e0;
      --lavender-600:#9d87d1;
      --beige:#f7f3eb;
      --ink:#2a2438;
      --muted:#7b6f8e;
      --white:#ffffff;
    }
    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0; background:var(--beige);
      color:var(--ink);
      font-family:'Cormorant', serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card{
      width:min(880px, 100%);
      background:var(--white);
      border-radius:24px; box-shadow:0 10px 30px rgba(42,36,56,.12);
      overflow:hidden; border:1px solid rgba(157,135,209,.18);
    }
    header{
      padding:28px 28px 16px;
      background:linear-gradient(135deg, var(--beige), #fff 40%, var(--beige));
    }
    .title{
      font-family:'Allura', cursive; font-size:48px; line-height:1; margin:0 0 8px;
      color:var(--lavender-600);
      text-align:center;
    }
    .subtitle{ text-align:center; margin:0; color:var(--muted); font-size:20px; }

    .progress-wrap{ padding:12px 28px 0; }
    .progress{
      width:100%; height:10px; background:#efeaf8; border-radius:999px; overflow:hidden; position:relative;
    }
    .progress > span{ display:block; height:100%; width:0%; background:var(--lavender-600); transition:width .35s ease; }
    .progress-text{ text-align:right; font-size:14px; color:var(--muted); margin-top:6px; }

    .content{ padding:24px 28px 32px; }

    /* question header + two big split buttons */
    .qmeta{ text-align:center; font-size:28px; color:var(--muted); margin-bottom:10px; }
    .question{ font-size:28px; margin:8px 0 18px; text-align:center; font-weight:600; }
    .options{ display:grid; grid-template-columns:1fr 1fr; gap:14px; max-width:720px; margin:14px auto 8px; }
    @media (max-width:719px){ .options{ grid-template-columns:1fr; } }

    .btn{
      appearance:none; border:none; cursor:pointer; border-radius:16px; padding:18px 16px; font-size:18px; line-height:1.2;
      background:#faf7ff; color:var(--ink); box-shadow:0 4px 14px rgba(157,135,209,.18);
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      border:1px solid rgba(157,135,209,.22);
    }
    .btn.half{ min-height:100px; }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 6px 18px rgba(157,135,209,.22); background:#f7f1ff; }
    .btn:active{ transform:translateY(0); }
    .btn.selected{ outline:3px solid var(--lavender-600); box-shadow:0 0 0 4px rgba(157,135,209,.15); background:#efeaf8; border-color: var(--lavender-600); }

    /* shake feedback when pressing Next without a pick */
    @keyframes shake { 10%, 90% {transform: translateX(-1px);} 20%,80% {transform: translateX(2px);} 30%,50%,70% {transform: translateX(-4px);} 40%,60% {transform: translateX(4px);} }
    .need-pick { animation: shake .4s; }

    .nav{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:18px; }
    .nav button{
      padding:12px 16px; border-radius:14px; border:1px solid rgba(157,135,209,.35);
      background:var(--white); font-size:16px; cursor:pointer; color:var(--ink);
    }
    .nav button.primary{ background:var(--lavender-600); color:#fff; border-color:transparent; }
    .nav button[disabled]{ opacity:.45; cursor:not-allowed; }

    .footer-note{ text-align:center; color:var(--muted); font-size:14px; margin-top:8px; }

    /* Result */
    .result{ display:none; text-align:center; padding:8px 0; }
    .score-wrap{ display:flex; align-items:center; gap:8px; margin:18px auto; max-width:520px; }
    .bar{ height:16px; width:100%; background:#efeaf8; border-radius:999px; overflow:hidden; display:flex; }
    .bar .cha{ background:#f3d8ee; height:100%; width:50%; transition:width .6s ease; }
    .bar .gianlu{ background:#cfd4ff; height:100%; width:50%; transition:width .6s ease; }
    .legend{ display:flex; justify-content:space-between; font-size:16px; color:var(--muted); }
    .pill{ display:inline-block; padding:6px 10px; background:#efeaf8; border-radius:999px; font-size:14px; color:var(--muted); margin:4px; }
    .share{ margin-top:14px; }

    .hidden{ display:none !important; }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="game-title">
    <header>
      <h1 id="game-title" class="title">Vibe Cha ðŸ’œ vs Vibe Gianlu ðŸ§¢</h1>
      <p class="subtitle">This or That â€” Pick your vibe. Discover your team at the end!</p>
    </header>

    <div class="progress-wrap">
      <div class="progress" aria-hidden="true"><span id="progressBar"></span></div>
      <div class="progress-text" id="progressText">Question 1 of 14</div>
    </div>

    <section class="content" id="quiz">
      <div class="qmeta" id="qMeta"></div>
      <div class="question" id="questionText"></div>
      <div class="options" id="options"></div>
      <div class="nav">
        <button id="prevBtn" aria-label="Previous question">âŸµ Back</button>
        <button id="nextBtn" class="primary" aria-label="Next question">Next âŸ¶</button>
      </div>
      <p class="footer-note">Your picks are private â€” weâ€™ll reveal your team only at the end ðŸ’Œ</p>
    </section>

    <section class="content result" id="result">
      <h2 class="question" style="margin-top:0">Your Result</h2>
      <div class="score-wrap">
        <div class="bar" aria-hidden="true">
          <div class="gianlu" id="gBar" title="Gianlu"></div>
          <div class="cha" id="cBar" title="Cha"></div>
        </div>
      </div>
      <div class="legend" id="legend"> 
        <span>ðŸ§¢ Gianlu: <strong id="gPct">50%</strong></span>
        <span>ðŸ’œ Cha: <strong id="cPct">50%</strong></span>
      </div>
      <p id="summaryText" style="font-size:20px; margin-top:10px"></p>
      <div id="traits" style="margin:8px 0 2px"></div>

      <div class="share">
        <button id="shareBtn" class="primary" style="margin-right:8px">Share result</button>
        <button id="restartBtn">Play again</button>
        <div id="shareFeedback" class="footer-note" aria-live="polite" style="margin-top:8px; min-height:1.2em"></div>
      </div>
      <p class="footer-note">Psstâ€¦ Want to compare with the couple? Theyâ€™ll see the scoreboard at the wedding ðŸ˜‰</p>
    </section>
  </main>

<script>
  // --- Data model ---------------------------------------------------------
  const QUESTIONS = [
    { t: "ðŸŽ¬ Movies", left: "I fall asleep after 10 minutes", right: "I watch it till the end" },
    { t: "ðŸ›ï¸ Bed", left: "Bed must be made", right: "Who cares â€” Iâ€™ll get back in tonight" },
    { t: "ðŸª¥ Toothpaste", left: "Squeeze from the bottom", right: "Squeeze from the middle" },
    { t: "ðŸ’§ Hydration", left: "Sometimes the first glass is in the afternoon", right: "2L of water a day, no excuses" },
    { t: "ðŸ³ Cooking", left: "I cook, and I like", right: "Someone else cook for me, and I like" },
    { t: "âœ‰ï¸ Emails", left: "I write it in one go", right: "I reread it 10 times before sending" },
    { t: "ðŸ§³ Packing", left: "30 minutes before", right: "One week ahead" },
    { t: "â±ï¸ Eating pace", left: "I finish first", right: "People wait for me" },
    { t: "ðŸ”ï¸ / ðŸ–ï¸ Outdoors", left: "Mountain trek", right: "Beach day" },
    { t: "ðŸ’³ Shopping", left: "Check price first" , right: "Discover the price when paying" },
    { t: "ðŸ˜´ Sleep habits", left: "Iâ€™m asleep instantly", right: "I count sheep for an hour" },
    { t: "â˜Žï¸ Parents call", left: "2-minute call (if I answer)", right: "2-hour call" },
    { t: "ðŸŽ¿ Ski day", left: "All-day skipass and sandwiches in the backpack", right: "2-hours skipass, and lunch in the mountain hut" },
    { t: "ðŸŽ¢ Adrenaline", left: "Bungee jumping, why not?", right: "Not even if you pay me" }
  ];

  // --- Stato --------------------------------------------------------------
  // QUESTION_ORDER = ordine domande (puoi tenerlo fisso o mescolarlo)
  // SIDE_MAP[i] = 0 mostra left=Gianlu / right=Cha (ordine originale)
  // SIDE_MAP[i] = 1 swap (sinistra mostra il testo di 'right', destra mostra 'left')
  let index = 0;
  let QUESTION_ORDER = [];
  let SIDE_MAP = [];
  const answers = Array(QUESTIONS.length).fill(null); // 0 = scelto sinistra, 1 = scelto destra
  let currentShareText = '';

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function shuffleOrder(){
    QUESTION_ORDER = Array.from({length: QUESTIONS.length}, (_, i) => i);
    // Se vuoi anche randomizzare l'ordine delle DOMANDE, lascia la riga sotto.
    // Se NON vuoi, commentala.
    shuffle(QUESTION_ORDER);

    // Per ogni domanda generiamo una mappa lato (0 = normale, 1 = swap)
    SIDE_MAP = QUESTION_ORDER.map(() => Math.random() < 0.5 ? 0 : 1);
  }

  function currentIndex(){ return QUESTION_ORDER[index]; }
  function currentQuestion(){ return QUESTIONS[currentIndex()]; }
  const $ = sel => document.querySelector(sel);

  function updateProgress(){
    const pct = (index / QUESTIONS.length) * 100;
    $('#progressBar').style.width = pct + '%';
    $('#progressText').textContent = `Question ${index+1} of ${QUESTIONS.length}`;
  }

  function renderQuestion(){
    const data = currentQuestion();
    const flip = SIDE_MAP[index] === 1; // true = scambio i lati

    $('#qMeta').textContent = data.t || '';
    $('#questionText').textContent = '';

    const cont = $('#options');
    cont.innerHTML = '';

    const leftBtn = document.createElement('button');
    leftBtn.className = 'btn half left';
    leftBtn.type = 'button';

    const rightBtn = document.createElement('button');
    rightBtn.className = 'btn half right';
    rightBtn.type = 'button';

    // Se flip Ã¨ true, invertiamo i testi mostrati a schermo
    leftBtn.textContent  = flip ? data.right : data.left;
    rightBtn.textContent = flip ? data.left  : data.right;

    // Evidenziazione della scelta precedente (answers[index] = 0/1 su lato visivo)
    if (answers[index] === 0) leftBtn.classList.add('selected');
    if (answers[index] === 1) rightBtn.classList.add('selected');

    leftBtn.addEventListener('click', () => { answers[index] = 0; goNext(); });
    rightBtn.addEventListener('click', () => { answers[index] = 1; goNext(); });

    cont.appendChild(leftBtn);
    cont.appendChild(rightBtn);

    $('#prevBtn').disabled = index === 0;
    updateProgress();
  }

  function goNext(){
    if (answers[index] === null) {
      const cont = $('#options');
      cont.classList.remove('need-pick');
      void cont.offsetWidth; // restart anim
      cont.classList.add('need-pick');
      return;
    }
    if (index < QUESTIONS.length - 1){
      index++;
      renderQuestion();
    } else {
      finish();
    }
  }

  function goPrev(){
    if (index > 0){ index--; renderQuestion(); }
  }

  function finish(){
    let g = 0, c = 0;

    // Traduco ogni risposta lato-visivo (0/1) in persona (G/C) usando SIDE_MAP
    for (let i = 0; i < QUESTIONS.length; i++){
      const pickSide = answers[i];     // 0=sinistra, 1=destra (come visto dall'utente)
      const flipped = SIDE_MAP[i] === 1;

      // Mappatura: i testi originali sono left=Gianlu, right=Cha
      // Se non flippo: sinistra=G, destra=C
      // Se flippo:    sinistra=C, destra=G
      const pickedIsGianlu = flipped ? (pickSide === 1) : (pickSide === 0);
      if (pickedIsGianlu) g++; else c++;
    }

    const total = g + c;
    const gPct = Math.round((g/total)*100);
    const cPct = 100 - gPct;

    $('#gPct').textContent = gPct + '%';
    $('#cPct').textContent = cPct + '%';
    $('#gBar').style.width = gPct + '%';
    $('#cBar').style.width = cPct + '%';

    const summary = gPct > cPct
      ? "Youâ€™re more Team Gianlu ðŸ§¢ â€” chill, spontaneous, and a bit last-minute."
      : gPct < cPct
        ? "Youâ€™re more Team Cha ðŸ’œ â€” organized, caring, and always on top of things."
        : "Itâ€™s a perfect tie â€” a balanced duo of spontaneity and elegance!";
    $('#summaryText').textContent = summary;

    currentShareText = `I got ${gPct}% Gianlu ðŸ§¢ and ${cPct}% Cha ðŸ’œ on â€œTeam Cha vs Team Gianlu â€“ This or Thatâ€. ${summary} ${window.location.href}`;

    $('#quiz').classList.add('hidden');
    $('#result').style.display = 'block';
    $('#progressBar').style.width = '100%';
    $('#progressText').textContent = 'All done!';
  }

  // --- Events -------------------------------------------------------------
  $('#nextBtn').addEventListener('click', goNext);
  $('#prevBtn').addEventListener('click', goPrev);
  $('#restartBtn').addEventListener('click', () => {
    index = 0;
    for (let i=0;i<answers.length;i++) answers[i] = null;
    shuffleOrder(); // rimescola sia ordine domande (se attivo) sia lato risposte
    $('#result').style.display = 'none';
    $('#quiz').classList.remove('hidden');
    $('#shareFeedback').textContent = '';
    renderQuestion();
  });
  $('#shareBtn').addEventListener('click', async () => {
    const feedback = $('#shareFeedback');
    try {
      if (navigator.share) {
        await navigator.share({ title: 'Team Cha vs Team Gianlu', text: currentShareText });
        feedback.textContent = 'Shared!';
      } else if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(currentShareText);
        feedback.textContent = 'Copied to clipboard!';
      } else {
        const ta = document.createElement('textarea');
        ta.value = currentShareText; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        feedback.textContent = 'Copied to clipboard!';
      }
    } catch (e) {
      feedback.textContent = 'Could not share. Try copying manually.';
    }
    setTimeout(() => { feedback.textContent = ''; }, 3200);
  });

  // Init
  shuffleOrder();
  renderQuestion();
</script>

</body>
</html>
