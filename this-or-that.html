<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team Cha ðŸ’œ vs Team Gianlu ðŸ§¢ â€“ This or That</title>
  <link href="https://fonts.googleapis.com/css2?family=Allura&family=Cormorant:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --lavender:#bca9e0;
      --lavender-600:#9d87d1;
      --beige:#f7f3eb;
      --ink:#2a2438;
      --muted:#7b6f8e;
      --white:#ffffff;
    }
    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0; background:var(--beige);
      color:var(--ink);
      font-family:'Cormorant', serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card{
      width:min(880px, 100%);
      background:var(--white);
      border-radius:24px; box-shadow:0 10px 30px rgba(42,36,56,.12);
      overflow:hidden; border:1px solid rgba(157,135,209,.18);
      position:relative;
    }
    header{
      padding:28px 28px 16px;
      background:linear-gradient(135deg, var(--beige), #fff 40%, var(--beige));
    }
    .title{
      font-family:'Allura', cursive; font-size:48px; line-height:1; margin:0 0 8px;
      color:var(--lavender-600);
      text-align:center;
    }
    .subtitle{ text-align:center; margin:0; color:var(--muted); font-size:20px; }

    .progress-wrap{ padding:12px 28px 0; }
    .progress{
      width:100%; height:10px; background:#efeaf8; border-radius:999px; overflow:hidden; position:relative;
    }
    .progress > span{ display:block; height:100%; width:0%; background:var(--lavender-600); transition:width .35s ease; }
    .progress-text{ text-align:right; font-size:14px; color:var(--muted); margin-top:6px; }

    .content{ padding:24px 28px 32px; }

    .qmeta{ text-align:center; font-size:28px; color:var(--muted); margin-bottom:10px; }
    .question{ font-size:28px; margin:8px 0 18px; text-align:center; font-weight:600; }
    .options{ display:grid; grid-template-columns:1fr 1fr; gap:14px; max-width:720px; margin:14px auto 8px; }
    @media (max-width:719px){ .options{ grid-template-columns:1fr; } }

    .btn{
      appearance:none; border:none; cursor:pointer; border-radius:16px; padding:18px 16px; font-size:18px; line-height:1.2;
      background:#faf7ff; color:var(--ink); box-shadow:0 4px 14px rgba(157,135,209,.18);
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      border:1px solid rgba(157,135,209,.22);
    }
    .btn.half{ min-height:100px; }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 6px 18px rgba(157,135,209,.22); background:#f7f1ff; }
    .btn:active{ transform:translateY(0); }
    .btn.selected{ outline:3px solid var(--lavender-600); box-shadow:0 0 0 4px rgba(157,135,209,.15); background:#efeaf8; border-color: var(--lavender-600); }

    @keyframes shake { 10%, 90% {transform: translateX(-1px);} 20%,80% {transform: translateX(2px);} 30%,50%,70% {transform: translateX(-4px);} 40%,60% {transform: translateX(4px);} }
    .need-pick { animation: shake .4s; }

    .nav{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:18px; }
    .nav button{
      padding:12px 16px; border-radius:14px; border:1px solid rgba(157,135,209,.35);
      background:var(--white); font-size:16px; cursor:pointer; color:var(--ink);
    }
    .nav button.primary{ background:var(--lavender-600); color:#fff; border-color:transparent; }
    .nav button[disabled]{ opacity:.45; cursor:not-allowed; }

    .footer-note{ text-align:center; color:var(--muted); font-size:16px; margin-top:8px; }

    .result{ display:none; text-align:center; padding:8px 0; }
    .score-wrap{ display:flex; align-items:center; gap:8px; margin:18px auto; max-width:520px; }
    .bar{ height:16px; width:100%; background:#efeaf8; border-radius:999px; overflow:hidden; display:flex; }
    .bar .cha{ background:#f3d8ee; height:100%; width:50%; transition:width .6s ease; }
    .bar .gianlu{ background:#cfd4ff; height:100%; width:50%; transition:width .6s ease; }
    .legend{ display:flex; justify-content:space-between; font-size:18px; color:var(--muted); }
    .pill{ display:inline-block; padding:6px 10px; background:#efeaf8; border-radius:999px; font-size:16px; color:var(--muted); margin:4px; }
    .share{ margin-top:14px; }

    .hidden{ display:none !important; }

    .exit-wrap{
      display:flex; justify-content:center; padding:20px 0 32px;
    }
    .exit-btn{
      background:#fff; border:1px solid rgba(157,135,209,.35); border-radius:14px;
      padding:8px 16px; font-size:16px; color:var(--muted); cursor:pointer;
      transition:all .2s ease; box-shadow:0 2px 6px rgba(157,135,209,.1); margin-bottom:0;
    }
    .exit-btn:hover{ background:#f7f1ff; color:var(--ink); box-shadow:0 4px 12px rgba(157,135,209,.15); }

    /* Language overlay */
    .lang-overlay{
      position:fixed; inset:0; background:rgba(247,243,235,.92);
      display:flex; align-items:center; justify-content:center; padding:24px; z-index:50;
      backdrop-filter: blur(2px);
    }
    .lang-modal{
      width:min(560px, 100%); background:#fff; border:1px solid rgba(157,135,209,.35);
      border-radius:20px; padding:24px; box-shadow:0 12px 30px rgba(42,36,56,.12); text-align:center;
    }
    .lang-modal h2{
      margin:0 0 6px; font-family:'Allura', cursive; font-size:42px; color:var(--lavender-600);
    }
    .lang-modal p{ margin:0 0 18px; color:var(--muted); font-size:18px; }
    .lang-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .lang-btn{
      border:1px solid rgba(157,135,209,.35); background:#faf7ff; border-radius:14px; padding:14px 16px;
      font-size:18px; cursor:pointer; transition:.2s; box-shadow:0 4px 10px rgba(157,135,209,.15);
    }
    .lang-btn:hover{ background:#f7f1ff; transform:translateY(-1px); }
  </style>
</head>
<body>
  <!-- Language chooser -->
  <div id="langOverlay" class="lang-overlay" role="dialog" aria-modal="true">
    <div class="lang-modal">
      <h2>BenvenutÉ™ â€¢ Bienvenue</h2>
      <p>Scegli la lingua â€¢ Choisis la langue</p>
      <div class="lang-grid">
        <button class="lang-btn" data-lang="it" aria-label="Italiano">ðŸ‡®ðŸ‡¹ Italiano</button>
        <button class="lang-btn" data-lang="fr" aria-label="FranÃ§ais">ðŸ‡«ðŸ‡· FranÃ§ais</button>
      </div>
    </div>
  </div>

  <main class="card" role="main" aria-labelledby="game-title">
    <header>
      <h1 id="game-title" class="title">Vibe Cha ðŸ’œ vs Vibe Gianlu ðŸ§¢</h1>
      <p id="subtitle" class="subtitle">This or That â€” Pick your vibe. Discover your team at the end!</p>
    </header>

    <div class="progress-wrap">
      <div class="progress" aria-hidden="true"><span id="progressBar"></span></div>
      <div class="progress-text" id="progressText">Question 1 of 14</div>
    </div>

    <section class="content" id="quiz" aria-live="polite">
      <div class="qmeta" id="qMeta"></div>
      <div class="question" id="questionText"></div>
      <div class="options" id="options"></div>
      <div class="nav">
        <button id="prevBtn" aria-label="Previous question">âŸµ Back</button>
        <button id="nextBtn" class="primary" aria-label="Next question">Next âŸ¶</button>
      </div>
    </section>

    <section class="content result" id="result">
      <h2 id="resultTitle" class="question" style="margin-top:0">Your Result</h2>
      <div class="score-wrap">
        <div class="bar" aria-hidden="true">
          <div class="gianlu" id="gBar" title="Gianlu"></div>
          <div class="cha" id="cBar" title="Cha"></div>
        </div>
      </div>
      <div class="legend" id="legend"> 
        <span>ðŸ§¢ Gianlu: <strong id="gPct">50%</strong></span>
        <span>ðŸ’œ Cha: <strong id="cPct">50%</strong></span>
      </div>
      <p id="summaryText" style="font-size:22px; margin-top:10px"></p>
      <div id="traits" style="margin:8px 0 2px"></div>

      <div class="share">
        <button id="shareBtn" class="primary" style="margin-right:8px">Share result</button>
        <button id="restartBtn">Play again</button>
        <div id="shareFeedback" class="footer-note" aria-live="polite" style="margin-top:8px; min-height:1.2em"></div>
      </div>
    </section>

    <div class="exit-wrap">
      <button id="exitBtn" class="exit-btn" aria-label="Exit game">EXIT</button>
    </div>
  </main>

<script>
  // -------------------- i18n strings --------------------
  const STRINGS = {
    it: {
      subtitle: "This or That â€” Scegli il tuo vibe. Scopri il tuo team alla fine!",
      progress: (i,n) => `Domanda ${i} di ${n}`,
      back: "âŸµ Indietro",
      next: "Avanti âŸ¶",
      resultTitle: "Il tuo risultato",
      moreG: "Sei piÃ¹ Team Gianlu ðŸ§¢",
      moreC: "Sei piÃ¹ Team Cha ðŸ’œ",
      tie: "ParitÃ  perfetta!",
      share: "Condividi risultato",
      playAgain: "Rigioca",
      allDone: "Tutto fatto!",
      exit: "ESCI",
      shareText: (g,c,summary,url) => `Ho ottenuto ${g}% Gianlu ðŸ§¢ e ${c}% Cha ðŸ’œ in â€œTeam Cha vs Team Gianlu â€“ This or Thatâ€. ${summary} ${url}`
    },
    fr: {
      subtitle: "This or That â€” Choisis ton vibe. DÃ©couvre ton Ã©quipe Ã  la fin !",
      progress: (i,n) => `Question ${i} sur ${n}`,
      back: "âŸµ Retour",
      next: "Suivant âŸ¶",
      resultTitle: "Ton rÃ©sultat",
      moreG: "Tu es plutÃ´t Team Gianlu ðŸ§¢",
      moreC: "Tu es plutÃ´t Team Cha ðŸ’œ",
      tie: "Ã‰galitÃ© parfaite !",
      share: "Partager le rÃ©sultat",
      playAgain: "Rejouer",
      allDone: "C'est terminÃ© !",
      exit: "QUITTER",
      shareText: (g,c,summary,url) => `Jâ€™ai eu ${g}% Gianlu ðŸ§¢ et ${c}% Cha ðŸ’œ sur â€œTeam Cha vs Team Gianlu â€“ This or Thatâ€. ${summary} ${url}`
    }
  };

  // -------------------- Questions by language --------------------
  const QUESTIONS_BY_LANG = {
    it: [
      { t: "ðŸŽ¬ Film", left: "Mi addormento dopo 10 minuti", right: "Lo guardo fino alla fine" },
      { t: "ðŸ›ï¸ Letto", left: "Il letto va rifatto", right: "Chi se ne importa â€” stasera ci rientro" },
      { t: "ðŸª¥ Dentifricio", left: "Spremo dal fondo", right: "Spremo dal centro" },
      { t: "ðŸ’§ Idratazione", left: "A volte il primo bicchiere Ã¨ nel pomeriggio", right: "2L al giorno, senza scuse" },
      { t: "ðŸ³ Cucina", left: "Cucino io, e mi piace", right: "Cucina qualcun altro, e mi piace" },
      { t: "âœ‰ï¸ Email", left: "La scrivo di getto", right: "La rileggo 10 volte prima di inviare" },
      { t: "ðŸ§³ Valigia", left: "30 minuti prima", right: "Una settimana prima" },
      { t: "â±ï¸ Ritmo a tavola", left: "Finisco per primo", right: "Gli altri mi aspettano" },
      { t: "ðŸ”ï¸ / ðŸ–ï¸ Outdoor", left: "Trekking in montagna", right: "Giornata in spiaggia" },
      { t: "ðŸ’³ Shopping", left: "Controllo prima il prezzo", right: "Lo scopro alla cassa" },
      { t: "ðŸ˜´ Sonno", left: "Mi addormento subito", right: "Conto le pecore per unâ€™ora" },
      { t: "â˜Žï¸ Chiamata ai genitori", left: "Telefonata da 2 minuti (se rispondo)", right: "Telefonata da 2 ore" },
      { t: "ðŸŽ¿ Giornata sugli sci", left: "Skipass giornaliero + panini nello zaino", right: "Skipass 2 ore + pranzo in baita" },
      { t: "ðŸŽ¢ Adrenalina", left: "Bungee jumping? PerchÃ© no!", right: "Neanche se mi paghi" }
    ],
    fr: [
      { t: "ðŸŽ¬ Films", left: "Je mâ€™endors aprÃ¨s 10 minutes", right: "Je regarde jusquâ€™au bout" },
      { t: "ðŸ›ï¸ Lit", left: "Le lit doit Ãªtre fait", right: "On sâ€™en fiche â€” jâ€™y retourne ce soir" },
      { t: "ðŸª¥ Dentifrice", left: "Je presse par le bas", right: "Je presse au milieu" },
      { t: "ðŸ’§ Hydratation", left: "Parfois le premier verre est lâ€™aprÃ¨s-midi", right: "2 L par jour, pas dâ€™excuses" },
      { t: "ðŸ³ Cuisine", left: "Je cuisine, et jâ€™aime", right: "Quelquâ€™un cuisine pour moi, et jâ€™aime" },
      { t: "âœ‰ï¸ Emails", left: "Jâ€™Ã©cris dâ€™un seul jet", right: "Je relis 10 fois avant dâ€™envoyer" },
      { t: "ðŸ§³ Bagage", left: "30 minutes avant", right: "Une semaine Ã  lâ€™avance" },
      { t: "â±ï¸ Ã€ table", left: "Je finis en premier", right: "On mâ€™attend" },
      { t: "ðŸ”ï¸ / ðŸ–ï¸ Plein air", left: "RandonnÃ©e en montagne", right: "JournÃ©e plage" },
      { t: "ðŸ’³ Shopping", left: "Je vÃ©rifie le prix dâ€™abord", right: "Je le dÃ©couvre Ã  la caisse" },
      { t: "ðŸ˜´ Sommeil", left: "Je mâ€™endors tout de suite", right: "Je compte les moutons une heure" },
      { t: "â˜Žï¸ Appel aux parents", left: "Appel de 2 minutes (si je rÃ©ponds)", right: "Appel de 2 heures" },
      { t: "ðŸŽ¿ JournÃ©e ski", left: "Forfait journÃ©e + sandwichs dans le sac", right: "Forfait 2 h + dÃ©jeuner au refuge" },
      { t: "ðŸŽ¢ AdrÃ©naline", left: "Saut Ã  lâ€™Ã©lastique ? Pourquoi pas !", right: "MÃªme payÃ©, jamais" }
    ]
  };

  // --------------- State ---------------
  let LANG = null;
  let QUESTIONS = [];
  let index = 0;
  let QUESTION_ORDER = [];
  let SIDE_MAP = [];
  const answers = [];
  let currentShareText = '';

  // Helpers
  const $ = sel => document.querySelector(sel);
  function tkey() { return STRINGS[LANG]; }

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  function shuffleOrder(){
    QUESTION_ORDER = Array.from({length: QUESTIONS.length}, (_, i) => i);
    shuffle(QUESTION_ORDER);
    SIDE_MAP = QUESTION_ORDER.map(() => Math.random() < 0.5 ? 0 : 1);
  }
  function currentIndex(){ return QUESTION_ORDER[index]; }
  function currentQuestion(){ return QUESTIONS[currentIndex()]; }

  function updateProgress(){
    const pct = (index / QUESTIONS.length) * 100;
    $('#progressBar').style.width = pct + '%';
    $('#progressText').textContent = tkey().progress(index+1, QUESTIONS.length);
  }

  function renderQuestion(){
    const data = currentQuestion();
    const flip = SIDE_MAP[index] === 1;

    $('#qMeta').textContent = data.t || '';
    $('#questionText').textContent = '';

    const cont = $('#options');
    cont.innerHTML = '';

    const leftBtn = document.createElement('button');
    leftBtn.className = 'btn half left';
    leftBtn.type = 'button';

    const rightBtn = document.createElement('button');
    rightBtn.className = 'btn half right';
    rightBtn.type = 'button';

    leftBtn.textContent  = flip ? data.right : data.left;
    rightBtn.textContent = flip ? data.left  : data.right;

    if (answers[index] === 0) leftBtn.classList.add('selected');
    if (answers[index] === 1) rightBtn.classList.add('selected');

    leftBtn.addEventListener('click', () => { answers[index] = 0; goNext(); });
    rightBtn.addEventListener('click', () => { answers[index] = 1; goNext(); });

    cont.appendChild(leftBtn);
    cont.appendChild(rightBtn);

    $('#prevBtn').disabled = index === 0;
    updateProgress();
  }

  function goNext(){
    if (answers[index] == null) {
      const cont = $('#options');
      cont.classList.remove('need-pick');
      void cont.offsetWidth;
      cont.classList.add('need-pick');
      return;
    }
    if (index < QUESTIONS.length - 1){
      index++;
      renderQuestion();
    } else {
      finish();
    }
  }

  function goPrev(){
    if (index > 0){ index--; renderQuestion(); }
  }

  function finish(){
    let g = 0, c = 0;

    for (let i = 0; i < QUESTIONS.length; i++){
      const pickSide = answers[i];
      const flipped = SIDE_MAP[i] === 1;
      const pickedIsGianlu = flipped ? (pickSide === 1) : (pickSide === 0);
      if (pickedIsGianlu) g++; else c++;
    }

    const total = g + c;
    const gPct = Math.round((g/total)*100);
    const cPct = 100 - gPct;

    $('#gPct').textContent = gPct + '%';
    $('#cPct').textContent = cPct + '%';
    $('#gBar').style.width = gPct + '%';
    $('#cBar').style.width = cPct + '%';

    const summary = gPct > cPct ? tkey().moreG : gPct < cPct ? tkey().moreC : tkey().tie;
    $('#summaryText').textContent = summary;

    currentShareText = tkey().shareText(gPct, cPct, summary, window.location.href);

    $('#quiz').classList.add('hidden');
    $('#result').style.display = 'block';
    $('#progressBar').style.width = '100%';
    $('#progressText').textContent = tkey().allDone;
  }

  function applyUIStrings(){
    $('#subtitle').textContent = tkey().subtitle;
    $('#prevBtn').textContent = tkey().back;
    $('#nextBtn').textContent = tkey().next;
    $('#resultTitle').textContent = tkey().resultTitle;
    $('#shareBtn').textContent = tkey().share;
    $('#restartBtn').textContent = tkey().playAgain;
    $('#exitBtn').textContent = tkey().exit;
    document.documentElement.lang = LANG;
  }

  function startGameWithLanguage(lang){
    LANG = lang;
    QUESTIONS = QUESTIONS_BY_LANG[LANG].slice();
    index = 0;
    QUESTION_ORDER = [];
    SIDE_MAP = [];
    answers.length = QUESTIONS.length;
    for (let i=0;i<answers.length;i++) answers[i] = null;

    applyUIStrings();
    shuffleOrder();
    $('#result').style.display = 'none';
    $('#quiz').classList.remove('hidden');
    $('#shareFeedback').textContent = '';
    renderQuestion();
  }

  // -------------------- Events --------------------
  $('#nextBtn').addEventListener('click', goNext);
  $('#prevBtn').addEventListener('click', goPrev);
  $('#restartBtn').addEventListener('click', () => {
    index = 0;
    for (let i=0;i<answers.length;i++) answers[i] = null;
    shuffleOrder();
    $('#result').style.display = 'none';
    $('#quiz').classList.remove('hidden');
    $('#shareFeedback').textContent = '';
    renderQuestion();
  });

  $('#shareBtn').addEventListener('click', async () => {
    const feedback = $('#shareFeedback');
    try {
      if (navigator.share) {
        await navigator.share({ title: 'Team Cha vs Team Gianlu', text: currentShareText });
        feedback.textContent = 'Shared!';
      } else if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(currentShareText);
        feedback.textContent = 'Copied to clipboard!';
      } else {
        const ta = document.createElement('textarea');
        ta.value = currentShareText; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        feedback.textContent = 'Copied to clipboard!';
      }
    } catch {
      feedback.textContent = 'Could not share. Try copying manually.';
    }
    setTimeout(() => { feedback.textContent = ''; }, 3200);
  });

  document.getElementById('exitBtn').addEventListener('click', () => {
    window.location.href = 'https://www.charlottegianluca.it/home.html'; // <-- tua home
  });

  // Language overlay handlers
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const lang = e.currentTarget.dataset.lang;
      $('#langOverlay').style.display = 'none';
      startGameWithLanguage(lang);
    });
  });

  // Start: show overlay, wait for selection
  // (Se vuoi un default automatico, togli lâ€™overlay e chiama startGameWithLanguage('it'))
</script>
</body>
</html>
